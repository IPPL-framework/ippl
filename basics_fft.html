<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IPPL (Independent Parallel Particle Layer): Basics: FFT</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IPPL (Independent Parallel Particle Layer)<span id="projectnumber">&#160;2.0</span>
   </div>
   <div id="projectbrief">IPPL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Basics: FFT </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="fft"></a>
Introduction</h1>
<p >The FFT(Fast Fourier Transform) class performs complex-to-complex, real-to-complex and real-to-real on IPPL Fields. Currently, we use heffte for taking the transforms and the class FFT serves as an interface between IPPL and heffte. In making this interface, we have referred Cabana library <a href="https://github.com/ECP-copa/Cabana">https://github.com/ECP-copa/Cabana</a>.</p>
<h2><a class="anchor" id="FFT"></a>
Transformation Types</h2>
<p >FFT is templated on the type of transform to be performed, the dimensionality of the Field to transform, and the floating-point precision type of the Field (float or double).</p>
<p ><b>Types of transformation</b></p><ul>
<li>complex-to-complex FFT: '<a class="el" href="classippl_1_1CCTransform.html">ippl::CCTransform</a>'</li>
<li>real-to-complex FFT: '<a class="el" href="classippl_1_1RCTransform.html">ippl::RCTransform</a>'</li>
<li>Sine transform: '<a class="el" href="classippl_1_1SineTransform.html">ippl::SineTransform</a>'</li>
<li>Cosine transform: '<a class="el" href="classippl_1_1CosTransform.html">ippl::CosTransform</a>'</li>
<li>Cosine type 1 transform: '<a class="el" href="classippl_1_1Cos1Transform.html">ippl::Cos1Transform</a>'</li>
</ul>
<h1><a class="anchor" id="Example"></a>
Usage</h1>
<p >Consider an example of a transformation from real valued Field to complex valued Field. Given a Field fieldInput, we can perform a forward FFT as follows: </p><div class="fragment"><div class="line"><span class="comment">// Define FFT-Parameters</span></div>
<div class="line"><a class="code hl_class" href="classippl_1_1ParameterList.html">ippl::ParameterList</a> fftParams;</div>
<div class="line">fftParams.<a class="code hl_function" href="classippl_1_1ParameterList.html#ab4b572b0db6bad6f631b23320a8f4722">add</a>(<span class="stringliteral">&quot;use_heffte_defaults&quot;</span>, <span class="keyword">true</span>);</div>
<div class="line">fftParams.<a class="code hl_function" href="classippl_1_1ParameterList.html#ab4b572b0db6bad6f631b23320a8f4722">add</a>(<span class="stringliteral">&quot;r2c_direction&quot;</span>, 0);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define layout of complex valued Field output</span></div>
<div class="line">std::array&lt;int, dim&gt; pt = {64, 64, 64};</div>
<div class="line">std::array&lt;double, dim&gt; dx = {</div>
<div class="line">    1.0 / double(pt[0]),</div>
<div class="line">    1.0 / double(pt[1]),</div>
<div class="line">    1.0 / double(pt[2]),</div>
<div class="line">};</div>
<div class="line"><a class="code hl_class" href="classippl_1_1Vector.html">ippl::Vector&lt;double, 3&gt;</a> hx     = {dx[0], dx[1], dx[2]};</div>
<div class="line"><a class="code hl_class" href="classippl_1_1Vector.html">ippl::Vector&lt;double, 3&gt;</a> origin = {0, 0, 0};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classippl_1_1NDIndex.html">ippl::NDIndex&lt;dim&gt;</a> ownedOutput;</div>
<div class="line"><span class="keywordflow">if</span> (fftParams.<a class="code hl_function" href="classippl_1_1ParameterList.html#a6e880ee49a119e6366ee0a1d20307423">get</a>&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;r2c_direction&quot;</span>) == 0) {</div>
<div class="line">        ownedOutput[0] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[0] / 2 + 1);</div>
<div class="line">        ownedOutput[1] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[1]);</div>
<div class="line">        ownedOutput[2] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[2]);</div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fftParams.<a class="code hl_function" href="classippl_1_1ParameterList.html#a6e880ee49a119e6366ee0a1d20307423">get</a>&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;r2c_direction&quot;</span>) == 1) {</div>
<div class="line">        ownedOutput[0] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[0]);</div>
<div class="line">        ownedOutput[1] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[1] / 2 + 1);</div>
<div class="line">        ownedOutput[2] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[2]);</div>
<div class="line">} <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fftParams.<a class="code hl_function" href="classippl_1_1ParameterList.html#a6e880ee49a119e6366ee0a1d20307423">get</a>&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;r2c_direction&quot;</span>) == 2) {</div>
<div class="line">        ownedOutput[0] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[0]);</div>
<div class="line">        ownedOutput[1] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[1]);</div>
<div class="line">        ownedOutput[2] = <a class="code hl_class" href="classippl_1_1Index.html">ippl::Index</a>(pt[2] / 2 + 1);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceippl.html#abfab7f67f977ee069d97c58cef8bd486">ippl::Comm</a>-&gt;rank() == 0) {</div>
<div class="line">            std::cerr &lt;&lt; <span class="stringliteral">&quot;RCDirection need to be 0, 1 or 2 and it&quot;</span></div>
<div class="line">            &lt;&lt; <span class="stringliteral">&quot;indicates the dimension in which data is shortened&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">            }</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_class" href="classippl_1_1FieldLayout.html">ippl::FieldLayout&lt;dim&gt;</a> layoutOutput(MPI_COMM_WORLD, ownedOutput, isParallel);</div>
<div class="line"><a class="code hl_class" href="classippl_1_1UniformCartesian.html">Mesh_t</a> meshOutput(ownedOutput, hx, origin);</div>
<div class="line">field_type_complex fieldOutput(meshOutput, layoutOutput);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Fill Field fieldInput with random numbers</span></div>
<div class="line"><span class="keyword">typename</span> field_type_real::view_type&amp; view            = fieldInput.getView();</div>
<div class="line"><span class="keyword">typename</span> field_type_real::HostMirror fieldInput_host = fieldInput.getHostMirror();</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> nghost = fieldInput.getNghost();</div>
<div class="line">std::mt19937_64 eng(42 + <a class="code hl_variable" href="namespaceippl.html#abfab7f67f977ee069d97c58cef8bd486">ippl::Comm</a>-&gt;rank());</div>
<div class="line">std::uniform_real_distribution&lt;double&gt; unif(0, 1);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = nghost; i &lt; view.extent(0) - nghost; ++i) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = nghost; j &lt; view.extent(1) - nghost; ++j) {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = nghost; k &lt; view.extent(2) - nghost; ++k) {</div>
<div class="line">            fieldInput_host(i, j, k) = unif(eng);  <span class="comment">// 1.0;</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line">Kokkos::deep_copy(fieldInput.getView(), fieldInput_host);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define FFT object</span></div>
<div class="line"><span class="keyword">typedef</span> <a class="code hl_class" href="classippl_1_1FFT.html">ippl::FFT&lt;ippl::RCTransform, field_type_real&gt;</a> FFT_type;</div>
<div class="line">std::unique_ptr&lt;FFT_type&gt; fft;</div>
<div class="line">fft = std::make_unique&lt;FFT_type&gt;(layoutInput, layoutOutput, fftParams);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Perform FFT</span></div>
<div class="line">fft-&gt;transform(<a class="code hl_enumvalue" href="namespaceippl.html#a12b1fb701e417c82f2d2249c31e30b02a94a1c1d486fcecd6f86646b8ace721eb">ippl::FORWARD</a>, fieldInput, fieldOutput); <span class="comment">// Forward transform</span></div>
<div class="line">fft-&gt;transform(<a class="code hl_enumvalue" href="namespaceippl.html#a12b1fb701e417c82f2d2249c31e30b02ab4d57d0e5e5de2de6a68b7d324356e62">ippl::BACKWARD</a>, fieldInput, fieldOutput); <span class="comment">// Reverse transform</span></div>
<div class="ttc" id="aclassippl_1_1FFT_html"><div class="ttname"><a href="classippl_1_1FFT.html">ippl::FFT</a></div><div class="ttdef"><b>Definition:</b> FFT.h:164</div></div>
<div class="ttc" id="aclassippl_1_1FieldLayout_html"><div class="ttname"><a href="classippl_1_1FieldLayout.html">ippl::FieldLayout</a></div><div class="ttdef"><b>Definition:</b> FieldLayout.h:166</div></div>
<div class="ttc" id="aclassippl_1_1Index_html"><div class="ttname"><a href="classippl_1_1Index.html">ippl::Index</a></div><div class="ttdef"><b>Definition:</b> Index.h:40</div></div>
<div class="ttc" id="aclassippl_1_1NDIndex_html"><div class="ttname"><a href="classippl_1_1NDIndex.html">ippl::NDIndex</a></div><div class="ttdef"><b>Definition:</b> NDIndex.h:21</div></div>
<div class="ttc" id="aclassippl_1_1ParameterList_html"><div class="ttname"><a href="classippl_1_1ParameterList.html">ippl::ParameterList</a></div><div class="ttdef"><b>Definition:</b> ParameterList.h:29</div></div>
<div class="ttc" id="aclassippl_1_1ParameterList_html_a6e880ee49a119e6366ee0a1d20307423"><div class="ttname"><a href="classippl_1_1ParameterList.html#a6e880ee49a119e6366ee0a1d20307423">ippl::ParameterList::get</a></div><div class="ttdeci">T get(const std::string &amp;key) const</div><div class="ttdef"><b>Definition:</b> ParameterList.h:59</div></div>
<div class="ttc" id="aclassippl_1_1ParameterList_html_ab4b572b0db6bad6f631b23320a8f4722"><div class="ttname"><a href="classippl_1_1ParameterList.html#ab4b572b0db6bad6f631b23320a8f4722">ippl::ParameterList::add</a></div><div class="ttdeci">void add(const std::string &amp;key, const T &amp;value)</div><div class="ttdef"><b>Definition:</b> ParameterList.h:44</div></div>
<div class="ttc" id="aclassippl_1_1UniformCartesian_html"><div class="ttname"><a href="classippl_1_1UniformCartesian.html">ippl::UniformCartesian</a></div><div class="ttdef"><b>Definition:</b> UniformCartesian.h:14</div></div>
<div class="ttc" id="aclassippl_1_1Vector_html"><div class="ttname"><a href="classippl_1_1Vector.html">ippl::Vector</a></div><div class="ttdef"><b>Definition:</b> Vector.h:23</div></div>
<div class="ttc" id="anamespaceippl_html_a12b1fb701e417c82f2d2249c31e30b02a94a1c1d486fcecd6f86646b8ace721eb"><div class="ttname"><a href="namespaceippl.html#a12b1fb701e417c82f2d2249c31e30b02a94a1c1d486fcecd6f86646b8ace721eb">ippl::FORWARD</a></div><div class="ttdeci">@ FORWARD</div><div class="ttdef"><b>Definition:</b> FFT.h:63</div></div>
<div class="ttc" id="anamespaceippl_html_a12b1fb701e417c82f2d2249c31e30b02ab4d57d0e5e5de2de6a68b7d324356e62"><div class="ttname"><a href="namespaceippl.html#a12b1fb701e417c82f2d2249c31e30b02ab4d57d0e5e5de2de6a68b7d324356e62">ippl::BACKWARD</a></div><div class="ttdeci">@ BACKWARD</div><div class="ttdef"><b>Definition:</b> FFT.h:64</div></div>
<div class="ttc" id="anamespaceippl_html_abfab7f67f977ee069d97c58cef8bd486"><div class="ttname"><a href="namespaceippl.html#abfab7f67f977ee069d97c58cef8bd486">ippl::Comm</a></div><div class="ttdeci">std::unique_ptr&lt; mpi::Communicator &gt; Comm</div><div class="ttdef"><b>Definition:</b> Ippl.h:22</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
