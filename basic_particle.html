<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IPPL (Independent Parallel Particle Layer): Basics: Particles</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IPPL (Independent Parallel Particle Layer)
   </div>
   <div id="projectbrief">IPPL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Basics: Particles </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Introduction to handling particles in IPPL. </p>
<h1><a class="anchor" id="particles"></a>
Particles in IPPL</h1>
<p >IPPL provides a flexible and efficient framework for handling particles in parallel computing environments.</p>
<h2><a class="anchor" id="particle_concepts"></a>
Key Concepts</h2>
<p >The core components are <code>ParticleBase</code> and <code>ParticleAttrib</code> classes, which provide the base functionality and attributes for particles.</p><ul>
<li><code>ParticleBase</code> acts as the abstract base class for a set of particles, requiring a derived class to specify data attributes (e.g., mass, charge).</li>
<li><code>ParticleAttrib&lt;T&gt;</code> represents a single particle attribute, with T indicating the data type.</li>
</ul>
<h3><a class="anchor" id="particle_base"></a>
'ParticleBase'</h3>
<p >The user must define a class derived from 'ParticleBase' which describes what specific data attributes the particle has (e.g., mass or charge). 'ParticleBase' is the abstract base class for a set of particles. Each attribute is an instance of a ParticleAttribute&lt;T&gt; class; 'ParticleBase' keeps a list of pointers to these attributes, and performs particle creation and destruction.</p>
<p >'ParticleBase' is templated on the 'ParticleLayout' mechanism for the particles. This template parameter should be a class derived from 'ParticleLayout'. 'ParticleLayout'-derived classes maintain the info on which particles are located on which processor, and performs the specific communication required between processors for the particles. The 'ParticleLayout' is templated on the type and dimension of the atom position attribute, and 'ParticleBase' uses the same types for these items as the given 'ParticleLayout'.</p>
<p >'ParticleBase' and all derived classes have the following common characteristics:</p><ul>
<li>The spatial positions of the N particles are stored in the particle_position_type variable R</li>
<li>The global index of the N particles are stored in the particle_index_type variable ID</li>
<li>A pointer to an allocated layout class. When you construct a 'ParticleBase', you must provide a layout instance, and 'ParticleBase' will delete this instance when it (the 'ParticleBase') is deleted.</li>
</ul>
<p >To use this class, the user defines a derived class with the same structure as in this example: </p><div class="fragment"><div class="line"><span class="keyword">class </span>UserParticles :</div>
<div class="line">         <span class="keyword">public</span> ParticleBase&lt; ParticleSpatialLayout&lt;double,3&gt; &gt; {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// attributes for this class</span></div>
<div class="line">  ParticleAttribute&lt;double&gt; rad;  <span class="comment">// radius</span></div>
<div class="line">  particle_position_type    vel;  <span class="comment">// velocity, same storage type as R</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">// constructor: add attributes to base class</span></div>
<div class="line">  UserParticles(ParticleSpatialLayout&lt;double,2&gt;* L) : ParticleBase(L) {</div>
<div class="line">    addAttribute(rad);</div>
<div class="line">    addAttribute(vel);</div>
<div class="line">  }</div>
<div class="line">};</div>
</div><!-- fragment --><p> This example defines a user class with 3D position and two extra attributes: a radius rad (double), and a velocity vel (a 3D Vector).</p>
<h3><a class="anchor" id="particle_attrib"></a>
ParticleAttrib and ParticleAttribBase</h3>
<p >These classes form the foundation for all particle attribute classes within the framework.</p>
<p >ParticleAttrib is a templated class designed to represent a single particle attribute, such as mass or charge. It encapsulates an attribute as a data element within a particle object, stored using a Kokkos::View for efficient parallel computation. This class is essential for handling the type information of the attribute and provides a suite of methods for creating, destroying, and performing operations on particle attributes.</p>
<p >ParticleAttribBase serves as the generic base class for the templated ParticleAttrib class. It provides a common interface for all particle attribute classes, including virtual methods for creating and destroying elements of the attribute array. By encapsulating data for a variable number of particles in a Kokkos::View, it facilitates operations on this data.</p>
<h3><a class="anchor" id="particle_layout"></a>
ParticleLayout and ParticleSpatialLayout</h3>
<p >ParticleLayout manages particle distribution and serves as a base class for ParticleSpatialLayout.</p>
<p >ParticleSpatialLayout is a derivative of ParticleLayout, ParticleSpatialLayout specifically handles particle distribution based on spatial positions relative to a predefined grid. It ensures particles are processed on the same MPI rank as their corresponding spatial region, defined by 'FieldLayout'. It requires periodic updates to adjust particle locations.</p>
<h2><a class="anchor" id="particle_example"></a>
Example: Defining a Particle Bunch</h2>
<p >Here's how you can define a simple particle bunch in IPPL:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceippl.html">ippl</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> PLayout&gt;</div>
<div class="line"><span class="keyword">struct </span>Bunch : <span class="keyword">public</span> <a class="code hl_class" href="classippl_1_1ParticleBase.html">ParticleBase</a>&lt;PLayout&gt; {</div>
<div class="line">    <a class="code hl_class" href="classippl_1_1ParticleAttrib.html">ParticleAttrib&lt;double&gt;</a> mass, charge;</div>
<div class="line">    <a class="code hl_class" href="classippl_1_1ParticleAttrib.html">ParticleAttrib&lt;Vector&lt;double&gt;</a>&gt; R, V;</div>
<div class="line"> </div>
<div class="line">    Bunch(PLayout&amp; layout) : <a class="code hl_class" href="classippl_1_1ParticleBase.html">ParticleBase</a>&lt;PLayout&gt;(layout) {</div>
<div class="line">        <span class="comment">// add your own application attributes !</span></div>
<div class="line">        this-&gt;addAttribute(mass);</div>
<div class="line">        this-&gt;addAttribute(charge);</div>
<div class="line">        this-&gt;addAttribute(R);</div>
<div class="line">        this-&gt;addAttribute(V);</div>
<div class="line">    }</div>
<div class="line">   ~Bunch() = <span class="keywordflow">default</span>;</div>
<div class="line">};</div>
<div class="line"><span class="comment">// Compiled to single Kokkos Kernel</span></div>
<div class="line">bunch-&gt;R = bunch-&gt;R + dt * bunch-&gt;V;</div>
<div class="ttc" id="aclassippl_1_1ParticleAttrib_html"><div class="ttname"><a href="classippl_1_1ParticleAttrib.html">ippl::ParticleAttrib</a></div><div class="ttdef"><b>Definition:</b> ParticleAttrib.h:31</div></div>
<div class="ttc" id="aclassippl_1_1ParticleBase_html"><div class="ttname"><a href="classippl_1_1ParticleBase.html">ippl::ParticleBase</a></div><div class="ttdef"><b>Definition:</b> ParticleBase.h:87</div></div>
<div class="ttc" id="anamespaceippl_html"><div class="ttname"><a href="namespaceippl.html">ippl</a></div><div class="ttdef"><b>Definition:</b> Archive.h:20</div></div>
</div><!-- fragment --><p >This example demonstrates how to extend <code>ParticleBase</code> to create a <code>Bunch</code> class that includes common particle attributes and how to perform a single timestep.</p>
<h2><a class="anchor" id="useful_particle_functions"></a>
Useful Particle Functions</h2>
<p >Consider bunch a pointer to a derived class 'Bunch' from 'ParticleBase' and has attributes 'R', 'V', 'mass', 'charge' </p>
<h3><a class="anchor" id="helper_particle_functions"></a>
Helper Functions</h3>
<p >A collection of essential functions for particle manipulation and attribute management, such as creation, deletion, and data operations. </p><div class="fragment"><div class="line">    <span class="comment">// Creates nParticles locally by a core or GPU ( not the total no . of particles )</span></div>
<div class="line">    bunch-&gt;create( nParticles );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get the local number of particles in that rank ( in ippl there is a one - one correspondence</span></div>
<div class="line">between</div>
<div class="line">    <span class="comment">// MPI ranks and GPUs</span></div>
<div class="line">    <span class="keywordtype">size_t</span> localnum = bunch-&gt;getLocalNum ();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Particle deletion Function . invalid is a boolean View</span></div>
<div class="line">    <span class="comment">// marking which indices are invalid . destroyNum is the</span></div>
<div class="line">    <span class="comment">// total number of invalid particles</span></div>
<div class="line">    bunch-&gt;destroy(invalid, destroyNum );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Device and host views and the deep copy operations between them</span></div>
<div class="line">    <span class="comment">// similar to fields</span></div>
<div class="line">    Kokkos::deep_copy(bunch-&gt;R.getHostMirror(), bunch-&gt;R.getView ()); <span class="comment">// device to host</span></div>
<div class="line">    Kokkos::deep_copy(bunch-&gt;R.getView()      , bunch-&gt;R.getHostMirror()); <span class="comment">// host to device</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// sum () , prod () , min () and max () functions available for</span></div>
<div class="line">    <span class="comment">// particle attributes similar to fields</span></div>
<div class="line">    <span class="keyword">auto</span> Rsum = bunch-&gt;R.sum ();</div>
</div><!-- fragment --> <h3><a class="anchor" id="bdry_condition_particles"></a>
Boundary Conditions for Particles</h3>
<p >Setting up boundary conditions (e.g., periodic, reflective) for particle simulations. </p><div class="fragment"><div class="line"><span class="comment">// Types of BCs : PERIODIC , SINK , RFELECTIVE , NO</span></div>
<div class="line"><span class="comment">// Sets periodic BCs in all directions</span></div>
<div class="line">bunch-&gt;setParticleBC(<a class="code hl_enumvalue" href="namespaceippl.html#a5a55502ef522088786000165502b35f5ae7a291c105638e154907608be31ac862">ippl::BC::PERIODIC</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Assume a 3D problem</span></div>
<div class="line"><span class="keyword">typedef</span> std::array&lt;ippl::BC, 6 &gt; bc_container_type ;</div>
<div class="line">bc_container_type bcs ;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; ++ i ) {</div>
<div class="line">    bcs[i] = <a class="code hl_enumvalue" href="namespaceippl.html#a5a55502ef522088786000165502b35f5ab8777daf9a6bf246f43fdaa134dd9b71">ippl::BC::NO</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bcs[4] = <a class="code hl_enumvalue" href="namespaceippl.html#a5a55502ef522088786000165502b35f5ae7a291c105638e154907608be31ac862">ippl::BC::PERIODIC</a>;</div>
<div class="line">bcs[5] = <a class="code hl_enumvalue" href="namespaceippl.html#a5a55502ef522088786000165502b35f5ae7a291c105638e154907608be31ac862">ippl::BC::PERIODIC</a>;</div>
<div class="line"><span class="comment">// Sets open BCs in x and y directions but periodic in z direction</span></div>
<div class="line">bunch-&gt;setParticleBC( bcs );</div>
<div class="ttc" id="anamespaceippl_html_a5a55502ef522088786000165502b35f5ab8777daf9a6bf246f43fdaa134dd9b71"><div class="ttname"><a href="namespaceippl.html#a5a55502ef522088786000165502b35f5ab8777daf9a6bf246f43fdaa134dd9b71">ippl::NO</a></div><div class="ttdeci">@ NO</div><div class="ttdef"><b>Definition:</b> ParticleBC.h:15</div></div>
<div class="ttc" id="anamespaceippl_html_a5a55502ef522088786000165502b35f5ae7a291c105638e154907608be31ac862"><div class="ttname"><a href="namespaceippl.html#a5a55502ef522088786000165502b35f5ae7a291c105638e154907608be31ac862">ippl::PERIODIC</a></div><div class="ttdeci">@ PERIODIC</div><div class="ttdef"><b>Definition:</b> ParticleBC.h:12</div></div>
</div><!-- fragment --> <h3><a class="anchor" id="Interpolation_grid_particles"></a>
Interpolation between Grid and Particles</h3>
<p >Methods for data transfer between particles and grid, supporting operations like scatter and gather for efficient particle-field interaction. </p><div class="fragment"><div class="line"><span class="comment">// Particles-&gt; grid</span></div>
<div class="line"><span class="comment">// Can interpolate any particle attribute ( both scalar and vectors ) to the grid .</span></div>
<div class="line"><span class="comment">// Only linear ( cloud - in - cell ) interpolation is available at the moment .</span></div>
<div class="line"><span class="comment">// Interpolate a scalar particle attribute q ( e . g . charge ) onto the field rho .</span></div>
<div class="line">scatter(bunch-&gt;q , rho , this-&gt;R);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Grid - &gt; particles</span></div>
<div class="line"><span class="comment">// Can interpolate any field ( both scalar and vectors ) to the particles .</span></div>
<div class="line"><span class="comment">// Only linear interpolation is available at the moment .</span></div>
<div class="line"><span class="comment">// Interpolate a vector field E ( e . g . electric field ) to the particles</span></div>
<div class="line">gather (bunch-&gt;E , Efield , this-&gt;R);</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
