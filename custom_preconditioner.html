<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IPPL (Independent Parallel Particle Layer): Defining Custom Preconditioners</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IPPL (Independent Parallel Particle Layer)
   </div>
   <div id="projectbrief">IPPL</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Defining Custom Preconditioners </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md23"></a>
Introduction to the Preconditioner Base Class</h1>
<p >The preconditioner class in the IPPL framework serves as an abstract base class for different preconditioning strategies applied in iterative solvers. It encapsulates common functionalities and interfaces that are essential for all types of preconditioners. Structure of the Preconditioner Base Class</p>
<ul>
<li>Template Parameter: The class template Field determines the type of the numerical field the preconditioner will operate on.</li>
<li>Constructor: Constructors initialize the preconditioner, optionally setting a type name to identify the preconditioner strategy.</li>
<li>Virtual Function ('operator()'): This is a pure virtual function in the base class that must be implemented by derived classes to define the specific preconditioning behavior.</li>
</ul>
<p >Steps to Create a Custom Preconditioner </p>
<h2><a class="anchor" id="autotoc_md24"></a>
Step 1: Define the Preconditioner Class</h2>
<p >Begin by defining a new class that inherits from the 'preconditioner&lt;Field&gt;' provided by the IPPL framework. This new class should implement all abstract methods from the base class and can add additional members as needed for its specific strategy.</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Field&gt;</div>
<div class="line"><span class="keyword">struct </span>custom_preconditioner : <span class="keyword">public</span> preconditioner&lt;Field&gt; {</div>
<div class="line">    <span class="comment">// Additional member variables here</span></div>
<div class="line"> </div>
<div class="line">    custom_preconditioner(std::string name = <span class="stringliteral">&quot;Custom&quot;</span>) : preconditioner&lt;<a class="code hl_class" href="classippl_1_1Field.html">Field</a>&gt;(name) {</div>
<div class="line">        <span class="comment">// Initialization code here</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classippl_1_1Field.html">Field</a> operator()(<a class="code hl_class" href="classippl_1_1Field.html">Field</a>&amp; u)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="comment">// Implementation of preconditioning logic here</span></div>
<div class="line">        <span class="keywordflow">return</span> u; <span class="comment">// Placeholder return</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclassippl_1_1Field_html"><div class="ttname"><a href="classippl_1_1Field.html">ippl::Field&lt; T, Dim, Mesh_t&lt; Dim &gt;, Centering_t&lt; Dim &gt;, ViewArgs... &gt;</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md25"></a>
Step 2: Implement the Constructor</h2>
<p >Use the constructor of your custom preconditioner to initialize any data members and forward any necessary parameters to the base class constructor, which sets the type name of the preconditioner. </p>
<h2><a class="anchor" id="autotoc_md26"></a>
Step 3: Override the Operator Function</h2>
<p >Implement the 'operator()' function to apply your preconditioning logic to the input field. This method is crucial as it defines how the preconditioner modifies the input data, aligning with the specific algorithmic needs of your solver. </p>
<h1><a class="anchor" id="autotoc_md27"></a>
Example Implementations</h1>
<h2><a class="anchor" id="autotoc_md28"></a>
Jacobi Preconditioner</h2>
<p >The 'jacobi_preconditioner' provided by IPPL is a derived class of preconditioner. It implements a specific preconditioning strategy using an inverse diagonal matrix and a damping factor. Here is how it extends the base class:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Field, <span class="keyword">typename</span> InvDiagF&gt;</div>
<div class="line"><span class="keyword">struct </span>jacobi_preconditioner : <span class="keyword">public</span> preconditioner&lt;Field&gt; {</div>
<div class="line">    InvDiagF inverse_diagonal_m;</div>
<div class="line">    <span class="keywordtype">double</span> w_m;  <span class="comment">// Damping factor</span></div>
<div class="line"> </div>
<div class="line">    jacobi_preconditioner(InvDiagF&amp;&amp; inverse_diagonal, <span class="keywordtype">double</span> w = 1.0)</div>
<div class="line">        : preconditioner&lt;<a class="code hl_class" href="classippl_1_1Field.html">Field</a>&gt;(<span class="stringliteral">&quot;Jacobi&quot;</span>), inverse_diagonal_m(<a class="code hl_namespace" href="namespacestd.html">std</a>::move(inverse_diagonal)), w_m(w) {}</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classippl_1_1Field.html">Field</a> operator()(<a class="code hl_class" href="classippl_1_1Field.html">Field</a>&amp; u)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keyword">typename</span> Field::mesh_type&amp; mesh = u.<a class="code hl_function" href="classippl_1_1Field.html#abea4a038e36f4d8d55107df74356efb7">get_mesh</a>();</div>
<div class="line">        <span class="keyword">typename</span> Field::layout_type&amp; layout = u.<a class="code hl_function" href="classippl_1_1BareField.html#a03944cc0274a28c7d2de62c3d54a62bc">getLayout</a>();</div>
<div class="line">        <a class="code hl_class" href="classippl_1_1Field.html">Field</a> res(mesh, layout);</div>
<div class="line"> </div>
<div class="line">        res = inverse_diagonal_m(u);  <span class="comment">// Apply inverse diagonal matrix</span></div>
<div class="line">        res = w_m * res;              <span class="comment">// Apply damping factor</span></div>
<div class="line">        <span class="keywordflow">return</span> res;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="ttc" id="aclassippl_1_1BareField_html_a03944cc0274a28c7d2de62c3d54a62bc"><div class="ttname"><a href="classippl_1_1BareField.html#a03944cc0274a28c7d2de62c3d54a62bc">ippl::BareField::getLayout</a></div><div class="ttdeci">Layout_t &amp; getLayout() const</div><div class="ttdef"><b>Definition:</b> BareField.h:134</div></div>
<div class="ttc" id="aclassippl_1_1Field_html_abea4a038e36f4d8d55107df74356efb7"><div class="ttname"><a href="classippl_1_1Field.html#abea4a038e36f4d8d55107df74356efb7">ippl::Field::get_mesh</a></div><div class="ttdeci">KOKKOS_INLINE_FUNCTION Mesh_t &amp; get_mesh() const</div><div class="ttdef"><b>Definition:</b> Field.h:64</div></div>
<div class="ttc" id="anamespacestd_html"><div class="ttname"><a href="namespacestd.html">std</a></div><div class="ttdef"><b>Definition:</b> Tuple.h:352</div></div>
</div><!-- fragment --> <h2><a class="anchor" id="autotoc_md29"></a>
Scaling Preconditioner</h2>
<p >A simple example of a custom preconditioner that scales the input field can be structured as follows:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Field&gt;</div>
<div class="line"><span class="keyword">struct </span>scaling_preconditioner : <span class="keyword">public</span> preconditioner&lt;Field&gt; {</div>
<div class="line">    <span class="keywordtype">double</span> scale_factor;</div>
<div class="line"> </div>
<div class="line">    scaling_preconditioner(<span class="keywordtype">double</span> factor = 1.0)</div>
<div class="line">        : preconditioner&lt;<a class="code hl_class" href="classippl_1_1Field.html">Field</a>&gt;(<span class="stringliteral">&quot;Scaling&quot;</span>), scale_factor(factor) {}</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classippl_1_1Field.html">Field</a> operator()(<a class="code hl_class" href="classippl_1_1Field.html">Field</a>&amp; u)<span class="keyword"> override </span>{</div>
<div class="line">        <span class="keywordflow">return</span> scale_factor * u; <span class="comment">// Scales the input field</span></div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md30"></a>
Integration with Solvers</h1>
<p >To utilize your custom preconditioner in a solver, instantiate it and configure the solver to use it. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
